var module=angular.module("widgetAdmin",["ui.bootstrap"]);module.config(function(a){a.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)}}),module.controller("widgetsCtrl",function(a,b,c,d){a.getWidgetList=function(b){c.getWidgetList(b,a.widgetsPerPage).then(function(b){a.widgetList=c.widgetList,a.widgetCount=c.widgetCount})},a.saveWidget=function(b){var d=document.getElementById("FORM_SECURITY_TOKEN").value;c.createNewWidget(b,d).then(function(b){a.getWidgetList(f,g)})};var e=function(e){var h=d.widgetModal,i=b.open({templateUrl:h,controller:"widgetModalInstanceController",size:"lg",resolve:{widget:function(){return e}}});i.result.then(function(b){var d=document.getElementById("FORM_SECURITY_TOKEN").value;c.saveWidget(b,d).then(function(){a.getWidgetList(f,g)})},function(){})};a.editWidget=function(a){e(a)},a.addNewWidget=function(){e()},a.deleteWidget=function(b){var d=confirm("Are you sure you want to delete "+b.name+"?");d&&c.deleteWidget(b).then(function(){a.getWidgetList(f)})},a.$watch("currentPage + numPerPage",function(){f=(a.currentPage-1)*a.widgetsPerPage,g=a.widgetsPerPage,a.getWidgetList(f,g)}),a.widgetsPerPage=10,a.currentPage=1;var f=(a.currentPage-1)*a.widgetsPerPage,g=a.widgetsPerPage}),module.controller("widgetModalInstanceController",function(a,b,c){a.widget=c,a.confirm=function(){b.close(a.widget)},a.cancel=function(){b.dismiss("cancel")}}),module.controller("pageTemplatesCtrl",function(a,b,c,d){function e(b,d){c.getPageTemplatesList(b,d).then(function(b){a.pageTemplatesList=c.pageTemplatesList,a.totalItems=c.pageTemplatesCount.rowCount})}var f=function(a){var f=d.pageTemplateModal,i=b.open({templateUrl:f,controller:"pageTemplateModalInstanceController",size:"lg",resolve:{pageTemplate:function(){return a}}});i.result.then(function(a){var b=document.getElementById("FORM_SECURITY_TOKEN").value;c.savePageTemplate(a,b).then(function(){e(g,h)})},function(){})};a.addNewPageTemplate=function(){f()},a.editPageTemplate=function(a){f(a)},a.deletePageTemplate=function(a){var b=confirm("Are you sure you want to delete "+a.name+"?");b&&c.deletePageTemplate(a).then(function(){e(g,h)})},a.$watch("currentPage + numPerPage",function(){g=(a.currentPage-1)*a.itemsPerPage,h=a.itemsPerPage,e(g,h)}),a.itemsPerPage=10,a.currentPage=1;var g=(a.currentPage-1)*a.itemsPerPage,h=a.itemsPerPage}),module.controller("pageTemplateModalInstanceController",function(a,b,c,d){a.pageTemplate=c;var e=function(b){d.getUnusedWidgets(b).then(function(b){a.unusedWidgetList=d.unusedWidgetList})},f=function(b){b&&d.getWidgetsOnPageTemplate(b).then(function(){a.widgetsOnPage=d.widgetsOnPage})};a.getWidgetByName=function(b){for(var c in a.unusedWidgetList)a.unusedWidgetList.hasOwnProperty(c)&&a.unusedWidgetList[c].name===b&&(a.widgetObjectToAdd=a.unusedWidgetList[c])},a.addWidgetToPage=function(b,c,g,h){var i=document.getElementById("FORM_SECURITY_TOKEN").value;d.addWidgetToPage(b,c,g,h,i).then(function(b){a.widgetToAdd=void 0,document.getElementById("widgetToAdd").value="",f(a.pageTemplate),e()})},a.removeWidgetFromPage=function(b){var c=confirm("Do you want to remove "+b.name+"?");c&&d.removeWidgetFromPage(a.pageTemplate,b).then(function(b){f(a.pageTemplate),e()})},a.saveAndContinue=function(b){var c=document.getElementById("FORM_SECURITY_TOKEN").value;d.savePageTemplate(b,c).then(function(b){a.pageTemplate=b.data.WidgetPage[0]})},a.confirm=function(){b.close(a.pageTemplate)},a.cancel=function(){b.dismiss("cancel")};(a.currentPage-1)*a.itemsPerPage,a.itemsPerPage;f(c),e(c)}),module.service("widgetsSrv",function(a){var b="/super/widgets",c=this;this.saveWidget=function(c,d){var e;e=c.id?b+"/"+c.id:b+"/0";var f={};return f.Widget=c,f.FORM_SECURITY_TOKEN=d,a({method:"POST",url:e,data:f,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toggleEditingWidget=function(a){a.editing?a.editing=!1:a.editing=!0},this.getWidgetList=function(d,e){return a.get(b+"/"+d+"/"+e).then(function(a){return c.widgetList=a.data.Widgets,c.widgetCount=a.data.WidgetsCount[0].rowCount,{pagination:a.data.pagination}})},this.deleteWidget=function(c){var d=b+"/remove/"+c.id;return a["delete"](d)}}),module.service("templateSrv",function(){this.pageTemplateModal="/render/widgets/pageTemplateModal",this.widgetModal="/render/widgets/widgetModal"}),module.service("pageTemplatesSrv",function(a){var b="/super/widgets/pages",c=this;this.savePageTemplate=function(c,d){var e;e=c.id?b+"/"+c.id:b+"/0";var f={};return c.isSystemPage=1,f.WidgetPage=c,f.FORM_SECURITY_TOKEN=d,a({method:"POST",url:e,data:f,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a})},this.getPageTemplatesList=function(d,e){return a.get(b+"/"+d+"/"+e).then(function(a){c.pageTemplatesList=a.data.WidgetPages,c.pageTemplatesCount=a.data.WidgetPagesCount[0]})},this.getWidgetsOnPageTemplate=function(d){return a.get(b+"/widgets/"+d.id).then(function(a){var b=[];for(var d in a.data)if(a.data.hasOwnProperty(d)&&"widgets/super_widgetpages_widgets_list"!==d&&"modules"!==d)for(var e in a.data[d])a.data[d].hasOwnProperty(e)&&(a.data[d][e].sectionName=d,b.push(a.data[d][e]));c.widgetsOnPage=b})},this.getUnusedWidgets=function(b){return b?a.get("/super/widgets/unassigned/all/"+b.id).then(function(a){c.unusedWidgetList=a.data.Widgets}):a.get("/super/widgets/unassigned/all/0").then(function(a){c.unusedWidgetList=a.data.Widgets})},this.addWidgetToPage=function(c,d,e,f,g){var h=b+"/widgets/"+c.id,i={};return i.WidgetPageWidget={},i.WidgetPageWidget.Widgets_id=d.Widgets_id,i.WidgetPageWidget.ymlKey=f,i.WidgetPageWidget.sectionName=e,i.FORM_SECURITY_TOKEN=g,a({method:"POST",url:h,data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.removeWidgetFromPage=function(c,d){var e=b+"/widgets/remove/"+c.ymlKey+"/"+d.id;return a["delete"](e)},this.deletePageTemplate=function(c){var d=b+"/remove/"+c.id;return a["delete"](d)}});
//# sourceMappingURL=widgets.min.js.map